# üöÇ Railway.app Deployment Guide - Complete Setup

## ‚úÖ Pre-Deployment Checklist

Sab kuch ready hai! Main ne automatically setup kar diya hai:

### üìÅ Files Created/Updated:
- ‚úÖ `railway.json` - Railway build config
- ‚úÖ `nixpacks.toml` - Python environment config
- ‚úÖ `.railwayignore` - Files to ignore during deploy
- ‚úÖ `Procfile` - Web, Worker, Beat processes
- ‚úÖ `runtime.txt` - Python 3.11.8 (Railway compatible)
- ‚úÖ `requirements.txt` - Added `dj-database-url` & `whitenoise`
- ‚úÖ `core/settings.py` - Railway environment support added

---

## üéØ Deployment Steps (Railway.app Dashboard)

### STEP 1: Railway.app Account Setup

1. **Sign Up / Login:**
   ```
   https://railway.app
   ```
   - GitHub account se login karo (recommended)
   - Ya email/password se signup karo

2. **New Project Create:**
   - Dashboard pe "New Project" button click karo
   - "Deploy from GitHub repo" select karo
   - Apna GitHub account connect karo
   - `TESTREPO` repository select karo

---

### STEP 2: Database Setup (PostgreSQL)

Railway automatically database suggest karega:

1. **Add PostgreSQL:**
   - Project dashboard pe "New" button ‚Üí "Database" ‚Üí "Add PostgreSQL"
   - Railway automatically `DATABASE_URL` environment variable set kar dega

2. **Verify Database:**
   - PostgreSQL service click karo
   - "Connect" tab me `DATABASE_URL` copy kar lo (backup ke liye)

---

### STEP 3: Environment Variables Setup

Project settings me "Variables" tab me jao aur ye add karo:

```bash
# Django Settings
SECRET_KEY=your-super-secret-key-here-change-this
DEBUG=False
RAILWAY_ENVIRONMENT=production
ALLOWED_HOSTS=.railway.app,.up.railway.app

# Twilio (existing credentials)
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+1234567890

# HumeAI (existing credentials)
HUME_API_KEY=your_hume_api_key
HUME_SECRET_KEY=your_hume_secret_key

# Stripe (existing credentials)
STRIPE_SECRET_KEY=your_stripe_secret_key
STRIPE_PUBLISHABLE_KEY=your_stripe_publishable_key
STRIPE_WEBHOOK_SECRET=your_stripe_webhook_secret

# Redis (for Celery - Railway provides)
REDIS_URL=${REDIS_URL}

# Google OAuth (if using)
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

# OpenAI (if using)
OPENAI_API_KEY=your_openai_api_key
```

**Auto-Generated by Railway:**
- ‚úÖ `DATABASE_URL` - PostgreSQL connection
- ‚úÖ `PORT` - Server port
- ‚úÖ `RAILWAY_PUBLIC_DOMAIN` - Your public URL
- ‚úÖ `RAILWAY_PRIVATE_DOMAIN` - Internal URL

---

### STEP 4: Deploy Application

1. **Automatic Deployment:**
   - Railway GitHub se code pull karega
   - Automatically build hoga using `nixpacks.toml`
   - Deploy hoga using `Procfile`

2. **Build Process (Automatic):**
   ```bash
   # Railway runs these automatically:
   1. pip install -r requirements.txt
   2. python manage.py collectstatic --noinput
   3. python manage.py migrate --noinput
   4. daphne -b 0.0.0.0 -p $PORT core.asgi:application
   ```

3. **Monitor Deployment:**
   - "Deployments" tab me live logs dekho
   - Build status check karo
   - Errors agar hain to logs me dikhenge

---

### STEP 5: Add Redis (for Celery)

1. **Add Redis Database:**
   - Project me "New" ‚Üí "Database" ‚Üí "Add Redis"
   - Railway automatically `REDIS_URL` set kar dega

2. **Enable Celery Worker:**
   - Project dashboard pe "New" ‚Üí "Empty Service"
   - Service name: `celery-worker`
   - Settings ‚Üí Deploy ‚Üí Start Command:
   ```bash
   celery -A core worker --loglevel=info
   ```

3. **Enable Celery Beat (Scheduler):**
   - Project dashboard pe "New" ‚Üí "Empty Service"
   - Service name: `celery-beat`
   - Settings ‚Üí Deploy ‚Üí Start Command:
   ```bash
   celery -A core beat --loglevel=info --scheduler django_celery_beat.schedulers:DatabaseScheduler
   ```

---

### STEP 6: Update Channel Layers (Redis)

**After Redis is added**, update `core/settings.py`:

```python
# Channel Layers Configuration
CHANNEL_LAYERS = {
    'default': {
        'BACKEND': 'channels_redis.core.RedisChannelLayer',
        'CONFIG': {
            "hosts": [config('REDIS_URL', default='redis://localhost:6379')],
        },
    },
}
```

Push to GitHub, Railway will auto-deploy.

---

### STEP 7: Domain & HTTPS

1. **Get Your URL:**
   - Railway automatically generates: `your-project.up.railway.app`
   - Copy this URL

2. **Custom Domain (Optional):**
   - Settings ‚Üí "Domains"
   - "Custom Domain" ‚Üí Add your domain
   - Update DNS records as Railway shows

3. **HTTPS:**
   - ‚úÖ Automatically enabled by Railway
   - ‚úÖ Settings already configured in `settings.py`

---

## üîß Post-Deployment Tasks

### 1. Create Superuser:

Railway CLI install karo:
```bash
npm i -g @railway/cli
railway login
railway link
railway run python manage.py createsuperuser
```

### 2. Test Application:

```bash
# Health check
https://your-project.up.railway.app/admin/

# API check
https://your-project.up.railway.app/api/

# WebSocket check (for calls)
wss://your-project.up.railway.app/ws/
```

### 3. Update Frontend URLs:

Apne frontend me backend URL update karo:
```javascript
const API_URL = 'https://your-project.up.railway.app/api';
const WS_URL = 'wss://your-project.up.railway.app/ws';
```

---

## üìä Monitoring & Logs

### View Logs:
```bash
# Railway Dashboard
- Project ‚Üí Select Service ‚Üí "Logs" tab

# Railway CLI
railway logs
railway logs --follow
```

### Metrics:
- CPU usage
- Memory usage
- Request rate
- Error rate

---

## üö® Troubleshooting

### Build Failed:

1. **Check Logs:**
   - Deployments ‚Üí Failed deployment ‚Üí View logs
   - Common issues:
     - Missing dependencies in `requirements.txt`
     - Python version mismatch
     - Environment variable missing

2. **Fix & Redeploy:**
   - Code fix karo
   - Git push karo
   - Railway automatically redeploy karega

### Database Migration Issues:

```bash
# Railway CLI se manually run karo
railway run python manage.py migrate
railway run python manage.py showmigrations
```

### Static Files Not Loading:

```bash
# Collectstatic manually run karo
railway run python manage.py collectstatic --noinput
```

### WebSocket Connection Failed:

- Verify Daphne is running (not Gunicorn)
- Check `ASGI_APPLICATION` in settings
- Verify `wss://` protocol in frontend

---

## üí∞ Railway Pricing

### Free Tier:
- ‚úÖ $5 credit per month
- ‚úÖ 512 MB RAM
- ‚úÖ 1 GB Disk
- ‚úÖ Shared CPU

### Hobby Plan ($5/month):
- ‚úÖ $5 credit + $5 usage
- ‚úÖ Better performance
- ‚úÖ More resources

### Pro Plan ($20/month):
- ‚úÖ $20 credit + unlimited usage
- ‚úÖ Dedicated resources
- ‚úÖ Priority support

**Note:** Your app ke usage ke hisaab se plan select karo.

---

## üîÑ Continuous Deployment

### Auto-Deploy on Git Push:

```bash
# Local changes karo
git add .
git commit -m "Your changes"
git push origin main

# Railway automatically:
1. Detects new commit
2. Builds application
3. Runs migrations
4. Deploys new version
5. Zero downtime deployment
```

### Rollback:

```bash
# Railway Dashboard
- Deployments ‚Üí Previous deployment ‚Üí "Redeploy"
```

---

## ‚úÖ Final Checklist

Deployment se pehle verify karo:

- [ ] All environment variables set
- [ ] PostgreSQL database added
- [ ] Redis database added (for Celery)
- [ ] Celery Worker service running
- [ ] Celery Beat service running
- [ ] Static files collected
- [ ] Migrations applied
- [ ] Superuser created
- [ ] Frontend URLs updated
- [ ] Test call made successfully

---

## üéâ Success!

Agar sab steps follow kiye to app successfully deploy ho gaya!

**Your Live URLs:**
- **Backend:** `https://your-project.up.railway.app`
- **Admin:** `https://your-project.up.railway.app/admin/`
- **API Docs:** `https://your-project.up.railway.app/swagger/`
- **WebSocket:** `wss://your-project.up.railway.app/ws/`

---

## üìû Support

**Railway Issues:**
- Railway Discord: https://discord.gg/railway
- Railway Docs: https://docs.railway.app

**Django Issues:**
- Check logs in Railway dashboard
- Debug locally first
- Use Railway CLI for debugging

---

**Deployment Date:** $(date)
**Python Version:** 3.11.8
**Django Version:** 5.2.7
**Database:** PostgreSQL (Railway)
**Server:** Daphne (ASGI)
**Status:** ‚úÖ Production Ready
